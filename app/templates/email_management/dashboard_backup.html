{% extends "base.html" %}

{% block content %}
<!-- Header Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="page-header p-4 rounded-3 position-relative overflow-hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); color: white;">
            <div class="position-relative z-index-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="display-6 fw-bold mb-2 animate__animated animate__fadeInLeft">
                            <i class="fas fa-envelope me-3"></i>Email Management
                        </h1>
                        <p class="lead mb-0 animate__animated animate__fadeInLeft" style="animation-delay: 0.2s;">
                            Configure and manage email notifications and templates
                        </p>
                    </div>
                </div>
            </div>
            <div class="position-absolute top-0 end-0 w-100 h-100 opacity-10">
                <i class="fas fa-envelope" style="font-size: 15rem; color: white; position: absolute; top: -2rem; right: -5rem; transform: rotate(15deg);"></i>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4 g-3">
    <div class="col-lg-3 col-sm-6">
        <div class="stat-card card h-100">
            <div class="card-body text-center">
                <i class="fas fa-users stat-icon text-primary"></i>
                <div class="stat-number text-primary">{{ stats.total_users }}</div>
                <div class="stat-label">Total Users</div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-sm-6">
        <div class="stat-card card h-100">
            <div class="card-body text-center">
                <i class="fas fa-user-check stat-icon text-success"></i>
                <div class="stat-number text-success">{{ stats.active_users }}</div>
                <div class="stat-label">Active Users</div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-sm-6">
        <div class="stat-card card h-100">
            <div class="card-body text-center">
                <i class="fas fa-bell stat-icon text-warning"></i>
                <div class="stat-number text-warning">{{ stats.pending_notifications }}</div>
                <div class="stat-label">Pending Notifications</div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-sm-6">
        <div class="stat-card card h-100">
            <div class="card-body text-center">
                <i class="fas fa-file-alt stat-icon text-info"></i>
                <div class="stat-number text-info">{{ stats.email_templates }}</div>
                <div class="stat-label">Email Templates</div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bolt me-2"></i>Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <a href="{{ url_for('email_management.email_templates') }}" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                            <span>Manage Templates</span>
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('email_management.email_settings') }}" class="btn btn-outline-secondary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                            <i class="fas fa-cog fa-2x mb-2"></i>
                            <span>Email Settings</span>
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('email_management.email_notifications') }}" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                            <i class="fas fa-bell fa-2x mb-2"></i>
                            <span>Notifications</span>
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('email_management.email_logs') }}" class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                            <i class="fas fa-list fa-2x mb-2"></i>
                            <span>Email Logs</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Test Email Section -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-paper-plane me-2"></i>Send Test Email
                </h5>
            </div>
            <div class="card-body">
                <form id="testEmailForm">
                    <div class="mb-3">
                        <label for="testEmail" class="form-label">Test Email Address</label>
                        <input type="email" class="form-control" id="testEmail" name="test_email" 
                               placeholder="Enter email address" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane me-2"></i>Send Test Email
                    </button>
                </form>
                <div id="testEmailResult" class="mt-3"></div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Email System Status
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="flex-shrink-0">
                        <div class="status-indicator bg-success"></div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-0">SMTP Connection</h6>
                        <small class="text-muted">Connected and ready</small>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <div class="flex-shrink-0">
                        <div class="status-indicator bg-success"></div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-0">Email Templates</h6>
                        <small class="text-muted">5 templates configured</small>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="status-indicator bg-warning"></div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-0">Automatic Notifications</h6>
                        <small class="text-muted">Some notifications disabled</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.stat-card {
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
}

.stat-label {
    color: #6c757d;
    font-size: 0.9rem;
}
</style>

<script>
document.getElementById('testEmailForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('testEmail').value;
    const resultDiv = document.getElementById('testEmailResult');
    
    // Show loading state
    resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Sending test email...</div>';
    
    // Send test email
    fetch('{{ url_for("email_management.send_test_email") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'test_email=' + encodeURIComponent(email)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check me-2"></i>' + data.message + '</div>';
        } else {
            resultDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>' + data.message + '</div>';
        }
    })
    .catch(error => {
        resultDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error sending test email</div>';
    });
});
</script>
{% endblock %}
