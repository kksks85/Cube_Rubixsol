{% extends "base.html" %}

{% block title %}Edit Template - {{ template.name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="fas fa-edit me-2"></i>Edit Template</h2>
                    <p class="text-muted mb-0">Modify service template: {{ template.name }}</p>
                </div>
                <div>
                    <a href="{{ url_for('service.view_template', id=template.id) }}" class="btn btn-outline-secondary">
                        <i class="fas fa-eye me-1"></i>View Template
                    </a>
                    <a href="{{ url_for('service.templates') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Back to Templates
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Template Information</h5>
                </div>
                <div class="card-body">
                    <form method="POST" novalidate>
                        {{ form.hidden_tag() }}
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                {{ form.name.label(class="form-label") }}
                                {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else "")) }}
                                {% if form.name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.name.errors %}{{ error }}{% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                {{ form.template_type.label(class="form-label") }}
                                {{ form.template_type(class="form-select" + (" is-invalid" if form.template_type.errors else "")) }}
                                {% if form.template_type.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.template_type.errors %}{{ error }}{% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.category_id.label(class="form-label") }}
                                {{ form.category_id(class="form-select") }}
                            </div>
                            <div class="col-md-6">
                                {{ form.estimated_time.label(class="form-label") }}
                                <div class="input-group">
                                    {{ form.estimated_time(class="form-control", placeholder="0") }}
                                    <span class="input-group-text">hours</span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            {{ form.description.label(class="form-label") }}
                            {{ form.description(class="form-control", rows="3", placeholder="Brief description of the service template...") }}
                        </div>

                        <div class="mb-3">
                            {{ form.procedure_steps.label(class="form-label") }}
                            <small class="text-muted">Enter each step on a new line</small>
                            {{ form.procedure_steps(class="form-control", rows="8", placeholder="1. First step of the procedure\n2. Second step of the procedure\n3. Continue with additional steps...") }}
                            {% if form.procedure_steps.errors %}
                            <div class="text-danger">
                                {% for error in form.procedure_steps.errors %}{{ error }}{% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.required_tools.label(class="form-label") }}
                            <small class="text-muted">Separate multiple tools with commas</small>
                            {{ form.required_tools(class="form-control", rows="3", placeholder="Screwdriver, Multimeter, Safety glasses, etc.") }}
                        </div>

                        <div class="mb-3">
                            {{ form.applicable_models.label(class="form-label") }}
                            <small class="text-muted">Product models this template applies to</small>
                            {{ form.applicable_models(class="form-control", rows="2", placeholder="DJI Phantom 4, Mavic Pro, Inspire 2, etc.") }}
                        </div>

                        <div class="mb-4">
                            {{ form.safety_notes.label(class="form-label") }}
                            <small class="text-muted">Important safety considerations and warnings</small>
                            {{ form.safety_notes(class="form-control", rows="3", placeholder="Always disconnect power before servicing. Wear protective equipment...") }}
                        </div>

                        <div class="d-flex justify-content-end gap-2">
                            <a href="{{ url_for('service.view_template', id=template.id) }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Update Template
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar with help and preview -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Template Tips</h5>
                </div>
                <div class="card-body">
                    <h6>Writing Effective Templates:</h6>
                    <ul class="small text-muted">
                        <li>Use clear, numbered steps for procedures</li>
                        <li>Include specific tools and parts needed</li>
                        <li>Add safety warnings for hazardous operations</li>
                        <li>Specify applicable UAV models</li>
                        <li>Include estimated completion time</li>
                    </ul>
                    
                    <h6 class="mt-3">Template Types:</h6>
                    <div class="small text-muted">
                        <div><span class="badge bg-success me-1">MAINTENANCE</span> Routine upkeep</div>
                        <div><span class="badge bg-primary me-1">REPAIR</span> Fix defects</div>
                        <div><span class="badge bg-warning me-1">INSPECTION</span> Quality checks</div>
                        <div><span class="badge bg-info me-1">UPGRADE</span> Improvements</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Template Info</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-6 text-muted">Template ID:</div>
                        <div class="col-6">#{{ template.id }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6 text-muted">Created:</div>
                        <div class="col-6">{{ template.created_at.strftime('%Y-%m-%d') }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6 text-muted">Last Updated:</div>
                        <div class="col-6">{{ template.updated_at.strftime('%Y-%m-%d') }}</div>
                    </div>
                    <div class="row">
                        <div class="col-6 text-muted">Created by:</div>
                        <div class="col-6">{{ template.creator.username if template.creator else 'Unknown' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-label {
    font-weight: 600;
    color: #495057;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.badge {
    font-size: 0.75rem;
}

.input-group-text {
    background-color: #e9ecef;
    border-color: #ced4da;
}

textarea.form-control {
    resize: vertical;
}
</style>
{% endblock %}
